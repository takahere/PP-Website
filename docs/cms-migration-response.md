# CMS移行に関する回答

## 前提

本ドキュメントは、CMS移行に関する質問への回答および検討状況の整理です。

---

## 1. 現状の課題

### 1-1. 運用の分散と属人化

- WordPress環境が2つ（サービスサイト + Partner Lab）存在し、業務委託メンバー中心で個別運用されている
- 担当が分かれており（大庭さん: Lab以外、ファラオさん: Lab側）、ナレッジが分散
- プラグインの絡み合いにより、変更の影響範囲が読めない状態

### 1-2. コンテンツ品質の劣化

- 内容が重複する別記事が存在
- タグ・カテゴリの整備が不十分
- content_typeの分類が曖昧（WPからスクレイピングして是正するスクリプトで対応している状態）

### 1-3. デザインの制約

- WPテーマ依存により、デザインの自由度が制限
- Apple的なLPのような高品質なデザインをWP上で実現するのが困難

### 1-4. データ可視化の不足

- 見たい数値が正確に可視化されていない
- 現状はAPIで手元取得してダッシュボード化したものが「正確っぽい」という状態

### 1-5. 現状システムの品質課題

コードベースを評価した結果、以下の課題がある：

| 領域 | 評価 | 状態 |
|------|------|------|
| エラーハンドリング | 6/10 | try-catchはあるが、構造化ログなし |
| セキュリティ | 5/10 | 認証は動作。CSRF保護なし、入力バリデーション不統一 |
| ログ・監視 | 3/10 | console.error()のみ。Sentryなし、ヘルスチェックなし |
| レートリミット | 2/10 | 公開APIが無防備 |
| バックアップ・DR | 3/10 | Supabaseデフォルト頼み。DR手順なし |

**「プロトタイプで作ること」と「サービスとして安全に運用すること」の間にギャップがある状態。** これは認識しており、対応が必要。

---

## 2. なぜ自社開発なのか

### 2-1. 市場の現状

海外のトップランナーが提供しているものは「個別SaaSの組み合わせ」または「コンセプト」レベル：

| ツール | 提供しているもの | 課題 |
|--------|----------------|------|
| HubSpot | Loop Marketing（コンテンツ→分析→最適化の自動ループ） | 独自言語（HubL）でデザイン自由度が低い。Enterprise $1,500/月 |
| Clearscope | SEOスコアリング・最適化提案 | $170/月。CMS別契約。データ分断 |
| MarketMuse | コンテンツギャップ分析・トピックモデリング | $300+/月。CMS別契約。データ分断 |
| Surfer SEO | SERP分析に基づくコンテンツ最適化 | $89/月。CMS別契約。データ分断 |
| Unbounce | LP自動生成・Smart Traffic（自動最適化） | LP専用。CMS別。$99/月 |

**これらを組み合わせると月$500-1,000+のSaaS費用 + データ分断 + ワークフロー分散。**

### 2-2. 目指している世界

海外が「個別SaaS」や「コンセプト」として語っていることを、**統合システムとしてPoC的に実装**する：

```
【現在の市場構造】
CMS + SEOツール + LPツール + Analytics
  → データ分断、ワークフロー分散、高コスト

【目指す姿】
統合プラットフォーム
  - CMS機能
  - SEOスコアリング・改善ループ
  - LP生成・最適化
  - Analytics統合ダッシュボード
  - 全部が1つのデータ基盤でつながる
```

### 2-3. STUDIOに移行しない理由

- STUDIOに移行しても、上記の統合は実現できない
- 結局「また別のツールが必要」「またデータが分断」「また移行したくなる」の繰り返し
- 移行コストをかけて得られるメリットがほぼない

### 2-4. HubSpotに移行しない理由

- Loop Marketingの概念は近いが、HubL（独自言語）への依存でデザイン自由度が低い
- Apple的LPのような高度なデザインが実現困難
- Enterprise（$1,500/月）でも制約は残る

### 2-5. 技術スタックの変化（WordPress → Next.js + Supabase）

| 観点 | WordPress（PHP） | Next.js + Supabase |
|------|-----------------|-------------------|
| 表示速度 | プラグイン数・サーバースペックに依存 | 静的HTML配信で高速。Vercel東京CDN |
| セキュリティ | PHP + プラグインの脆弱性リスク | 静的HTMLで攻撃面が小さい |
| 機能拡張 | プラグインで誰でも拡張可能 | コード開発が必要（Claude Code活用で緩和） |
| インフラ | 自前管理。PHP/MySQL更新が必要 | フルマネージド。サーバー管理不要 |
| デザイン自由度 | テーマ依存 | 完全自由 |

---

## 3. 中長期でやりたいこと

### 3-1. 実現したい機能

| 機能 | 内容 | 実装状態 |
|------|------|---------|
| コンテンツインテリジェンス | SEO自動改善ループ。記事を書くほど次の記事の質が上がる | 基盤実装済み |
| LP自動生成 | キーワード×業種でAI生成、量産体制 | セクションビルダー実装済み。AI生成は次フェーズ |
| ボトルネック自動診断 | 記事ごとに「次に何をすべきか」を自動判定 | API実装済み |
| KPI統合ダッシュボード | GA + GSC + HubSpot連携 | API実装済み。UI未 |
| リアルタイムA/Bテスト | バリアント自動振り分け | variant機能実装済み。自動振り分けは未 |
| Lab→サービス導線最適化 | CTA自動調整 | API実装済み。ロジック未 |
| デザイン完全自由度 | Apple的LP、高度なアニメーション | Next.js + Tailwindで実現可能 |

### 3-2. 既製品との構造的な差分

| 機能 | STUDIO等 | HubSpot | 自社開発CMS |
|------|----------|---------|-------------|
| LP手動作成 | ○ | ○ | ○ |
| LP自動生成（AI） | × | △ | ○ |
| SEO自動最適化ループ | × | △ | ○ |
| ボトルネック自動診断 | × | × | ○ |
| Lab KPI統合 | × | × | ○ |
| デザイン自由度 | 中 | 低（HubL制約） | 高 |
| 開発・保守コスト | 低 | 中 | 高 |

---

## 4. 将来構想と移行プラン

### フェーズ1: 基盤確立（2月）

**2/23 Must:**
- Apple的トップページLP公開
- `partner-prop.com/` トップページのみリプレイス
- SEO維持（リダイレクト、canonical）
- WP並行運用開始

**2月中 Should:**
- CI/CDパイプライン構築
- Sentry導入（エラー追跡）
- レートリミット追加
- 品質基準の明文化

### フェーズ2: 本番品質化 + Lab移行（3-5月）

| 項目 | 内容 |
|------|------|
| E2Eテスト有効化 | スキップ中のテスト復活、主要フロー追加 |
| セキュリティレビュー | CSRF対策、入力バリデーション統一、権限モデル見直し |
| Lab完全移行 | WP廃止 |
| KPIダッシュボードUI | 管理画面統合 |
| SEO改善ループ稼働 | スコアリング→改善提案→AI生成の自動化 |

### フェーズ3: LP量産・最適化（6月以降）

| 項目 | 内容 |
|------|------|
| LP自動生成 | キーワード×業種でAI生成 |
| A/Bテスト自動化 | variant自動振り分け |
| 導線最適化 | Lab→サービスサイトのCTA自動調整 |

### フェーズ4: 統合基盤化（将来）

| 項目 | 内容 |
|------|------|
| リリースノート統合 | コンテンツタイプ追加 |
| 他部署展開 | 全社CMS基盤として拡大 |
| プロダクト転用 | PRM製品へのコンテンツインテリジェンス機能組み込み |

---

## 5. 必要なリソース

### Takaさんで対応可能な範囲

- フロントエンド（LP実装、管理画面UI）
- API実装
- セクションビルダー拡張
- AI連携機能
- 入力バリデーション統一（Zod）

### Takaさん以外で必要なリソース

#### プラットフォーム/インフラ系

| タスク | 内容 | 工数目安 |
|--------|------|---------|
| CI/CDパイプライン構築 | GitHub Actions設定 | 1-2日 |
| Sentry導入 | エラー追跡、アラート設定 | 1日 |
| 構造化ログ設計 | ログフォーマット統一、集約基盤 | 2-3日 |
| DR手順策定・テスト | バックアップ復旧手順 | 2-3日 |
| ドメイン切り替え | DNS設定、WP並行運用時のルーティング | 要調査 |

#### セキュリティ系

| タスク | 内容 | 工数目安 |
|--------|------|---------|
| セキュリティレビュー | 認証・認可・入力バリデーションの網羅的確認 | 1-2週間 |
| CSRF対策実装 | トークン検証の追加 | 2-3日 |
| レートリミット実装 | 公開API、AI系エンドポイントへの制限 | 1日 |
| 権限モデル見直し | 細かい権限設計 | 3-5日 |

#### 合計見積

| フェーズ | 工数目安 | 備考 |
|---------|---------|------|
| 2月中（最小限） | **3-5人日** | CI/CD、Sentry、レートリミット |
| フェーズ2（本番品質化） | **2-4週間** | セキュリティレビューが最重 |

---

## 6. 品質評価コストについて

### 指摘の要旨

> フルスクラッチで作るとなると、全ての要件において品質評価が必要になり、既製品に比べて評価のコストが増大する。要件・評価基準の策定やテスト遂行のコスト増を含めてもなおメリットが大きいのであれば本番で運用する価値があるが、適切なステークホルダーにおける同意が必須。

**この指摘は正しい。**

### 既製品との品質評価コスト比較

| 評価対象 | 既製品 | 自社開発 |
|---------|--------|---------|
| CMS本体の機能品質 | ベンダーが担保 | 自分たちでテスト必要 |
| セキュリティ | ベンダーが担保 | 自分たちで評価必要 |
| ブラウザ互換性 | ベンダーが担保 | 自分たちで検証必要 |
| パフォーマンス | ベンダーに依存 | 自分たちで最適化・検証 |

**既製品であればベンダーが担保してくれる範囲を、自社開発では全て自分たちで評価しなければならない。**

### 対応方針

1. **CIでの自動テスト実行がない → 対応可能**（GitHub Actions設定で解決）
2. **E2Eテストの大半がスキップ → 対応可能**（コードは書いてある、有効化で解決）
3. **評価基準が未定義 → 対応可能**（明文化作業）
4. **セキュリティ評価が手動のみ → 追加リソース必要**

「やれていない」と「やれない」は別。技術的には対応可能だが、リソース（特にセキュリティレビュー）の確保が必要。

### First releaseのスコープによるリスク緩和

- 2/23の対象は「トップページLP 1枚」のみ
- LP表示自体は静的HTML配信に近い
- 管理画面のユーザーは内部の数名に限定
- セキュリティリスクの影響範囲は限定的

**→ 「本番サービス全体」ではなく「静的LP + 内部ツール」という限定スコープで、まず小さく出して品質を上げてから拡大するアプローチ。**

---

## 7. 総括

### 判断が必要なポイント

最終的には以下の問いに対するビジネス側の回答次第：

> **「CMSは単にページを作って公開するツール」で十分なのか、それとも「データに基づいてコンテンツを自動改善・量産するプラットフォーム」が必要なのか。**

前者なら既製品、後者なら自社開発。

### 自社開発を選ぶ場合に必要なこと

1. **品質評価の体制・コスト・責任者についてステークホルダーの明示的な同意**
2. **プラットフォーム/セキュリティのリソース確保**（2月最小限で3-5人日、本番品質化で2-4週間）
3. **段階的なアプローチ** — まず小さく出して品質を上げてから拡大

### 現状の事実

- 実装は既に相当進んでおり、「検討段階」ではなく「実装済みシステムの本番投入判断」というフェーズ
- 「プロトタイプレベル」と「本番サービス品質」の間にギャップがあることは認識している
- CI/CD、監視、セキュリティ強化は技術的に対応可能であり、段階的に整備していく方針
